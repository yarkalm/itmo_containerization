# Лабораторная работа 2

## Описание docker-compose.yml

### Сервис инициализации

Одноразовый сервис, который запускается только для инициализации данных.

- **Сборка:** создается из текущей директории с использованием `Dockerfile`.
- **Имя контейнера:** `init_container`
- **Зависимости:** зависит от сервиса `db`, что гарантирует запуск базы данных перед инициализацией.
- **Переменные окружения:** 
  - Конфигурация базы данных аналогична сервису `db`.
- **Сеть:** подключен к сети `main_network`.
- **Команда запуска:** `/bin/sh -c "echo 'Initializing data...'"` — команда, которая запускается для имитации инициализации данных в контейнере.

### Сервис `app`

Основной сервис, запускающий Jupyter Notebook.

- **Сборка:** создается из текущей директории с использованием `Dockerfile`.
- **Имя контейнера:** `jupyter_notebook`
- **Порты:**
  - `${JUPYTER_PORT}:8888`: пробрасывает порт Jupyter Notebook (8888) наружу, используя переменную окружения `JUPYTER_PORT`.
- **Тома:**
  - `./work:/home/jovyan/work`: монтирует директорию `work` из текущей директории на хосте в контейнер по пути `/home/jovyan/work` для сохранения данных.
- **Зависимости:** зависит от `db`, чтобы убедиться, что база данных готова перед запуском Jupyter Notebook.
- **Команда запуска:** `start-notebook.sh --NotebookApp.token=''` — запускает Jupyter Notebook без требования токена для доступа.
- **Healthcheck:**
  - **Команда:** `curl -f http://localhost:8888`, проверяет доступность Jupyter Notebook.
  - **Интервал проверки:** 30 секунд
  - **Таймаут:** 10 секунд
  - **Количество повторов:** 5
### База данных

- **Образ:** `postgres:latest`
- **Имя контейнера:** `postgres_db`
- **Переменные окружения:**
  - `POSTGRES_USER`: имя пользователя для доступа к базе данных
  - `POSTGRES_PASSWORD`: пароль для пользователя
  - `POSTGRES_DB`: название базы данных
- **Тома:**
  - `db_data:/var/lib/postgresql/data`: данные сохраняются в volume `db_data`, что обеспечивает сохранение данных после остановки контейнера.
- **Порты:**
  - `${DB_PORT}:5432`: пробрасывает порт PostgreSQL (5432) наружу, используя переменную окружения `DB_PORT`.
- **Healthcheck:**
  - **Команда:** `pg_isready -U ${POSTGRES_USER}`, проверяет готовность базы данных к приему запросов.
  - **Интервал проверки:** 10 секунд
  - **Таймаут:** 5 секунд
  - **Количество повторов:** 5
  
### Сеть `main_network`

- Создана сеть `main_network` с драйвером `bridge` для обеспечения взаимодействия между контейнерами `db`, `init` и `app`.

### Тома

- **db_data:** volume для базы данных PostgreSQL, который сохраняет данные на хосте и обеспечивает их сохранность при перезапуске контейнера.

---

## Запуск

Чтобы запустить все сервисы, выполните команду:

```bash
docker-compose up --build
```

### Ответы на вопросы:
1. **Можно ли ограничивать ресурсы (например, память или CPU) для сервисов в docker-compose.yml?**
  - Да. Это делается с помощью секции deploy, где указываются ограничения на использование процессора и памяти. Пример:
    ```yaml
    services:
        app:
          image: my_image
          deploy:
            resources:
              limits:
                cpus: "1.0"       # ограничение использования CPU до 1 ядра
                memory: "512M"     # ограничение использования памяти до 512 MB
      ```
2. **Как можно запустить только определенный сервис из docker-compose.yml, не запуская остальные?**
  - Чтобы запустить только один определенный сервис из docker-compose.yml, не запуская остальные, можно указать его имя в команде docker-compose up, например:
```bash
docker-compose up app
```
